#!/bin/sh
# Role: Pre-commit hook for Yalls AI - validates prompts and tiers
# Path: yalls-inc/yalls-ai/husky/pre-commit

echo "ğŸ” Yalls AI Pre-commit: Validating prompts and tiers..."

# Lint TypeScript
echo "ğŸ§¹ Linting TypeScript..."
npm run lint --workspace=yalls-inc/yalls-ai || exit 1

# Type check
echo "ğŸ”§ Type checking..."
npm run type-check --workspace=yalls-inc/yalls-ai || exit 1

# Validate tiered.model.ts capabilities
echo "ğŸ¯ Validating AI capabilities..."
node -e "
const { CAPABILITIES } = require('./yalls-inc/yalls-ai/libs/models/tiered.model.ts');
const validTiers = ['user', 'creator', 'business'];
CAPABILITIES.forEach(cap => {
  if (!validTiers.includes(cap.tier)) {
    console.error(\`âŒ Invalid tier: \${cap.tier} in capability \${cap.id}\`);
    process.exit(1);
  }
});
console.log('âœ… All capabilities valid');
" || exit 1

# Check for sensitive data in prompts (stub)
echo "ğŸ”’ Checking for sensitive data in prompts..."
# TODO: Scan for API keys, PII in prompt files

echo "âœ… Yalls AI pre-commit passed!"
